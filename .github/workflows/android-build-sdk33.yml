name: Android CI - ä½¿ç”¨ SDK 33 ç¼–è¯‘ï¼ˆå¤‡ç”¨ï¼‰

on:
  # ä»…æ”¯æŒæ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. æ£€å‡ºä»£ç 
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    # 2. è®¾ç½® JDK 11
    - name: è®¾ç½® JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
    
    # 3. è®¾ç½® Android SDK
    - name: è®¾ç½® Android SDK
      uses: android-actions/setup-android@v2
      with:
        api-level: 33
        build-tools: 33.0.2
    
    # 4. ä¸´æ—¶ä¿®æ”¹ build.gradle ä¸º SDK 33
    - name: ä¿®æ”¹ä¸º SDK 33
      run: |
        cd AndroidCaptchaSolver/app
        sed -i 's/compileSdk [0-9]*/compileSdk 33/g' build.gradle
        sed -i 's/targetSdk [0-9]*/targetSdk 33/g' build.gradle
        sed -i 's/compileSdkVersion [0-9]*/compileSdkVersion 33/g' build.gradle
        sed -i 's/targetSdkVersion [0-9]*/targetSdkVersion 33/g' build.gradle
    
    # 5. æˆäºˆ gradlew æ‰§è¡Œæƒé™
    - name: æˆäºˆ Gradle æ‰§è¡Œæƒé™
      run: |
        cd AndroidCaptchaSolver
        chmod +x gradlew
    
    # 6. ç¼–è¯‘ Debug APK
    - name: ç¼–è¯‘ Debug APK
      run: |
        cd AndroidCaptchaSolver
        ./gradlew assembleDebug --stacktrace
    
    # 7. ä¸Šä¼ ç¼–è¯‘å¥½çš„ APK
    - name: ä¸Šä¼  APK
      uses: actions/upload-artifact@v3
      with:
        name: app-debug-sdk33
        path: AndroidCaptchaSolver/app/build/outputs/apk/debug/app-debug.apk
        retention-days: 30
    
    # 8. æ˜¾ç¤ºç¼–è¯‘æˆåŠŸä¿¡æ¯
    - name: ç¼–è¯‘æˆåŠŸ
      run: |
        echo "âœ… APK ç¼–è¯‘æˆåŠŸï¼ˆä½¿ç”¨ SDK 33ï¼‰ï¼"
        echo "ğŸ“¦ åœ¨ Actions é¡µé¢åº•éƒ¨çš„ Artifacts éƒ¨åˆ†ä¸‹è½½ APK"
        echo "ğŸ”— è®¿é—®: https://github.com/${{ github.repository }}/actions"

