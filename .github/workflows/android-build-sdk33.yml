name: Android CI - 使用 SDK 33 编译（备用）

on:
  # 仅支持手动触发
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. 检出代码
    - name: 检出代码
      uses: actions/checkout@v3
    
    # 2. 设置 JDK 11
    - name: 设置 JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
    
    # 3. 设置 Android SDK
    - name: 设置 Android SDK
      uses: android-actions/setup-android@v2
      with:
        api-level: 33
        build-tools: 33.0.2
    
    # 4. 临时修改 build.gradle 为 SDK 33
    - name: 修改为 SDK 33
      run: |
        cd AndroidCaptchaSolver/app
        sed -i 's/compileSdk [0-9]*/compileSdk 33/g' build.gradle
        sed -i 's/targetSdk [0-9]*/targetSdk 33/g' build.gradle
        sed -i 's/compileSdkVersion [0-9]*/compileSdkVersion 33/g' build.gradle
        sed -i 's/targetSdkVersion [0-9]*/targetSdkVersion 33/g' build.gradle
    
    # 5. 授予 gradlew 执行权限
    - name: 授予 Gradle 执行权限
      run: |
        cd AndroidCaptchaSolver
        chmod +x gradlew
    
    # 6. 编译 Debug APK
    - name: 编译 Debug APK
      run: |
        cd AndroidCaptchaSolver
        ./gradlew assembleDebug --stacktrace
    
    # 7. 上传编译好的 APK
    - name: 上传 APK
      uses: actions/upload-artifact@v3
      with:
        name: app-debug-sdk33
        path: AndroidCaptchaSolver/app/build/outputs/apk/debug/app-debug.apk
        retention-days: 30
    
    # 8. 显示编译成功信息
    - name: 编译成功
      run: |
        echo "✅ APK 编译成功（使用 SDK 33）！"
        echo "📦 在 Actions 页面底部的 Artifacts 部分下载 APK"
        echo "🔗 访问: https://github.com/${{ github.repository }}/actions"

