# 验证码识别助手 V3 - 使用说明

## 📱 功能特性

### ✅ 已实现的功能

1. **自动验证码检测**
   - 实时监控屏幕内容
   - 自动识别九宫格验证码
   - 提取验证码提示文字和目标物体

2. **智能图片识别**
   - 使用Google ML Kit进行图像识别
   - 支持多种常见物体识别（飞机、汽车、动物、植物等）
   - 置信度阈值：65%（可调整）

3. **自动点击**
   - 自动点击包含目标物体的图片
   - 自动点击验证按钮
   - 无障碍服务辅助点击

4. **可移动悬浮窗**
   - 便捷的控制界面
   - 一键开始/停止监控
   - 手动触发识别

5. **实时状态提示**
   - Toast提示显示识别状态
   - 验证码检测提醒
   - 点击操作反馈

## 🚀 使用步骤

### 1. 安装应用
```bash
adb install app-debug.apk
```

### 2. 授予必要权限

应用首次启动时需要授予以下权限：

- ✅ **悬浮窗权限**：用于显示控制悬浮窗
- ✅ **屏幕录制权限**：用于捕获屏幕内容进行识别
- ✅ **无障碍服务权限**：用于执行自动点击操作
- ✅ **通知权限**（Android 13+）：用于显示前台服务通知
- ✅ **媒体权限**（Android 13+）：用于访问图片和视频

### 3. 启动监控

1. 打开应用
2. 点击"开始监控"按钮
3. 授予屏幕录制权限
4. 应用会显示"正在监控中"状态

### 4. 打开验证码

1. 打开包含九宫格验证码的页面（如币安APP）
2. 应用会自动检测验证码
3. 检测到验证码时会显示Toast提示
4. 自动识别图片并点击
5. 自动提交验证

## 📊 Toast提示说明

- `✅ 检测到验证码！目标: XXX` - 成功识别到验证码和目标物体
- `🎯 识别完成！需要点击 X 个图片` - 图片识别完成
- `✅ 点击完成，正在提交验证` - 点击操作完成
- `❌ OCR识别失败` - OCR识别出错

## ⚙️ 技术特性

### 架构设计
- **MediaProjection** - 稳定的屏幕捕获
- **Google ML Kit** - 强大的OCR和图像识别
- **AccessibilityService** - 可靠的自动点击
- **Foreground Service** - 持续后台监控

### 性能优化
- VirtualDisplay资源自动释放
- 2秒检查间隔，避免过度消耗
- 异步处理，不阻塞主线程
- CompletableFuture异步流水线

### Android 15+ 兼容性
- targetSdk 35
- 正确配置前台服务类型
- Android 13+ 媒体权限适配
- 最新的权限请求流程

## 🔧 调试信息

### 查看日志
```bash
adb logcat | grep -E "ScreenMonitor|OCR|ImageContent|Toast"
```

### 检查服务状态
```bash
adb shell dumpsys activity services | grep ScreenMonitorService
```

### 查看应用权限
```bash
adb shell dumpsys package com.captchasolver.v3 | grep "permission"
```

## 🐛 已知问题和解决方案

### 问题1：日志被系统过滤
**现象**：logcat中看不到应用日志
**解决**：使用Toast提示代替，或使用Log.e()级别

### 问题2：图片识别准确率
**现象**：识别到的图片数量不准确
**当前状态**：置信度阈值已提高到65%
**下一步**：根据实际测试结果继续调整

### 问题3：MediaProjection停止
**现象**：监控一段时间后停止工作
**解决**：已添加VirtualDisplay自动释放机制

## 📈 版本历史

### v3.0 (当前版本)
- ✅ 完整重构，使用MediaProjection替代AccessibilityService
- ✅ 集成Google ML Kit OCR和图像识别
- ✅ 添加Toast实时状态提示
- ✅ 优化资源管理和性能
- ✅ Android 15+ 完全兼容

### 下一步计划
- 🔄 进一步优化图片识别准确率
- 🔄 添加识别结果的可视化反馈
- 🔄 支持更多验证码类型
- 🔄 添加统计信息和成功率显示

## 💡 使用建议

1. **首次使用**：建议在测试环境中先试用，观察识别效果
2. **权限管理**：确保所有权限都已正确授予
3. **网络环境**：ML Kit首次使用可能需要下载模型，确保网络连接
4. **电池优化**：建议关闭应用的电池优化，避免被系统杀死

## 📞 反馈和支持

如有问题或建议，请反馈以便继续优化改进！

