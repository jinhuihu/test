# 📱 验证码识别助手 - 使用指南

## 🎯 功能说明

这是一个 Android 验证码识别助手，可以自动识别九宫格图片验证码并模拟点击。

**主要功能：**
- ✅ 自动识别目标物体文字（如"飞机"、"汽车"）
- ✅ 自动点击验证码图片
- ✅ 自动点击验证按钮
- ✅ 支持多种浏览器

---

## 🚀 快速开始（3 步）

### 第 1 步：下载并安装 APK

1. **下载 APK**  
   访问：https://github.com/jinhuihu/test/actions
   - 找到最新的成功编译（绿色 ✅）
   - 点击进入详情页
   - 滚动到底部 **Artifacts** 部分
   - 下载 `app-debug.zip`
   - 解压得到 `app-debug.apk`

2. **安装到手机**
   ```bash
   # 方法 1：使用 ADB
   adb install -r app-debug.apk
   
   # 方法 2：直接传输到手机安装
   ```

---

### 第 2 步：启用无障碍服务 ⭐ 最重要

1. **打开应用**
   - 点击"打开无障碍设置"按钮
   - 或手动进入：设置 → 辅助功能 → 无障碍

2. **启用服务**
   - 找到"验证码识别助手"
   - 点击进入
   - 打开开关
   - 授予权限（会弹出授权窗口）
   - 点击"允许"

3. **验证服务状态**
   - 返回应用
   - 应用中会显示"验证码识别服务已创建"

---

### 第 3 步：测试功能

#### 方法 1：自动识别（推荐）

1. **打开浏览器**（Chrome、UC、QQ 浏览器等）
2. **访问有验证码的网站**
3. **等待验证码出现**
4. **应用会自动识别并点击**
5. **查看应用日志确认**

#### 方法 2：手动触发（测试用）

1. **在浏览器中打开验证码页面**
2. **切换回验证码识别助手应用**
3. **点击"手动触发识别（测试）"按钮**
4. **立即切换回浏览器查看效果**
5. **查看应用中的日志信息**

---

## 🔍 功能详解

### 自动识别模式

**触发条件：**
- 在浏览器中打开验证码
- 窗口内容发生变化
- 自动延迟 1.5 秒后开始识别

**识别流程：**
1. ✓ 检测到浏览器应用
2. ✓ 查找目标物体文字（如"飞机"）
3. ✓ 点击所有可点击的图片元素
4. ✓ 查找并点击验证按钮

### 手动触发模式

**使用场景：**
- 调试和测试
- 自动识别未触发
- 需要即时识别

**使用方法：**
1. 打开验证码页面
2. 切换到应用
3. 点击"手动触发识别"
4. 立即返回浏览器

---

## 📋 支持的验证码类型

### 目标物体（已支持）

#### 交通工具
- 飞机、汽车、自行车、摩托车
- 公交车、卡车、轮船、火车

#### 交通设施
- 交通灯、消防栓、停车标志

#### 动物
- 鸟、猫、狗、马、羊、牛
- 大象、熊、斑马、长颈鹿

### 验证按钮文字（已支持）
- 验证、确认、提交、确定
- OK、Submit、Verify

---

## 🔧 常见问题

### ❓ 为什么没有反应？

**检查清单：**

1. **无障碍服务是否启用？** ⭐ 最重要
   - 设置 → 辅助功能 → 验证码识别助手
   - 确保开关已打开

2. **是否在支持的浏览器中？**
   - Chrome、UC、QQ 浏览器、Firefox
   - 其他浏览器可能不会自动触发

3. **查看日志输出**
   - 使用 ADB 查看：`adb logcat | grep CaptchaService`
   - 或在应用中查看日志区域

---

### ❓ 如何查看详细日志？

**方法 1：应用内日志**
- 打开应用
- 查看底部的日志显示区域
- 所有操作都会显示在这里

**方法 2：ADB 日志（更详细）**
```bash
# 查看所有日志
adb logcat | grep -E "CaptchaService|AccessibilityBasedSolver|ClickSimulator"

# 查看特定标签
adb logcat -s CaptchaService:D

# 清空日志后重新查看
adb logcat -c && adb logcat | grep CaptchaService
```

---

### ❓ 识别不准确怎么办？

**当前版本说明：**
- 使用简化的识别策略
- 会点击所有可点击的元素
- 不依赖图像识别（避免权限问题）

**改进方向：**
- 如果需要更精确的识别
- 需要授予屏幕录制权限
- 使用基于 ML Kit 的图像识别

---

### ❓ 如何调试？

**步骤：**

1. **启用无障碍服务**
2. **打开 ADB 日志监控**
   ```bash
   adb logcat | grep -E "CaptchaService|AccessibilityBasedSolver"
   ```
3. **打开验证码页面**
4. **观察日志输出：**
   - `事件: WINDOW_CONTENT_CHANGED` - 检测到窗口变化
   - `检测到浏览器应用` - 识别到浏览器
   - `触发验证码识别` - 开始识别流程
   - `步骤 1: 获取屏幕内容` - 获取节点成功
   - `找到目标物体: 飞机` - OCR 识别结果
   - `共点击了 X 个图片节点` - 点击图片
   - `成功点击验证按钮` - 点击验证按钮

---

## ⚙️ 高级配置

### 修改支持的浏览器

**文件：** `res/xml/accessibility_service_config.xml`

当前配置为监听所有应用。如果需要限制：

```xml
<!-- 限制特定浏览器 -->
<accessibility-service
    android:packageNames="com.android.chrome,com.UCMobile,com.tencent.mtt" />
```

### 调整延迟时间

**文件：** `CaptchaService.java`

```java
// 修改延迟时间（毫秒）
mainHandler.postDelayed(..., 1500);  // 默认 1.5 秒
```

### 添加更多目标物体

**文件：** `AccessibilityBasedSolver.java`

```java
private static final String[] TARGET_KEYWORDS = {
    "飞机", "汽车", // 已有
    "你的新物体"   // 添加新的
};
```

---

## 📊 版本说明

### 当前版本特性

- ✅ **简化版识别** - 不依赖屏幕截图
- ✅ **无额外权限** - 只需无障碍服务
- ✅ **即时可用** - 启用服务即可使用
- ✅ **手动触发** - 支持手动测试
- ✅ **实时日志** - 显示识别过程

### 适用场景

- ✅ 快速测试和调试
- ✅ 不想授予屏幕录制权限
- ✅ 简单的验证码场景
- ⚠️ 对精确度要求不高

---

## 🎯 测试示例

### 完整测试流程

```
1. 安装应用并启用无障碍服务
   ↓
2. 打开应用，确认服务已创建
   ↓
3. 打开 Chrome 浏览器
   ↓
4. 访问有验证码的网站
   ↓
5. 等待验证码出现
   ↓
6. 应用会自动识别并点击
   （查看应用日志或 ADB 日志）
   ↓
7. 如果没反应，点击"手动触发识别"
   ↓
8. 查看日志排查问题
```

---

## ⚠️ 注意事项

### 1. 权限要求

**必需权限：**
- ✅ 无障碍服务权限（手动启用）

**不需要的权限：**
- ❌ 屏幕录制权限（简化版不需要）
- ❌ 存储权限（简化版不需要）

### 2. 浏览器兼容性

**已测试：**
- Chrome
- UC 浏览器
- QQ 浏览器

**理论支持：**
- Firefox
- Edge
- 其他基于 Chromium 的浏览器

### 3. 识别准确率

**当前版本：**
- 使用简化策略
- 不依赖图像识别
- 点击所有可点击元素
- 准确率取决于验证码结构

---

## 🔗 相关链接

- 🏠 **GitHub 仓库**：https://github.com/jinhuihu/test
- ⚡ **下载 APK**：https://github.com/jinhuihu/test/actions
- 📖 **功能说明**：查看 `🎯功能实现说明.md`
- 📖 **代码检查**：查看 `✅代码检查报告.md`

---

## 💡 技巧和建议

### 提高成功率

1. **确保无障碍服务已启用**
2. **在验证码完全加载后再触发**
3. **使用手动触发测试识别流程**
4. **查看日志了解识别过程**
5. **如果失败，多试几次**

### 调试技巧

1. **查看 ADB 日志**
   ```bash
   adb logcat | grep -E "CaptchaService|AccessibilityBasedSolver"
   ```

2. **检查服务状态**
   ```bash
   adb shell settings get secure enabled_accessibility_services
   ```

3. **测试无障碍服务**
   - 确保能获取根节点
   - 确保能查找节点文本
   - 确保能执行点击操作

---

## 🎉 更新日志

### v2.0（当前版本）

- ✅ 新增基于无障碍服务的识别器
- ✅ 移除屏幕录制权限要求
- ✅ 添加手动触发功能
- ✅ 实时日志输出到界面
- ✅ 优化事件监听
- ✅ 支持所有应用监听

### v1.0

- ✅ 基于 ML Kit 的图像识别
- ✅ OCR 文字识别
- ⚠️ 需要屏幕录制权限

---

## 📞 反馈和支持

如有问题或建议：
- 📧 提交 GitHub Issue
- 📝 查看项目文档
- 🔍 查看 ADB 日志排查

---

**🎊 祝使用愉快！**
